#!/usr/bin/perl
# create and run dyna simulations
# Mark 04/21/05
use Switch;

@FocalDepths = qw(9p5 10 10p5 11 11p5 12 12p5 13 13p5 14 14p5 15 15p5 16 16p5 17 17p5 18 18p5 19 19p5);
@Alphas = qw(0p3 0p5 0p7 1p0 1p5 2p0);
@Fnums = qw{F1p0 F2p0};

foreach $FD (@FocalDepths)
	{
	foreach $A (@Alphas)
		{
		$FullPath = "/emfd/mlp6/CIRS_FEM/HomogSims/E4kPa_foc".$FD."mm_a".$A."_TopBCconst";
		chdir($FullPath);

		foreach $FN (@Fnums)
			{

			if(!-e $FN) 
				{ 
				system("mkdir $FN"); 
				}

			chdir($FN);
			system("pwd");

			if(!-e "zdisp.mat")
				{
				if(!-e "cirs.dyn" || $A == "1p0" || $A == "2p0")
					{
					system("scp /emfd/mlp6/CIRS_FEM/HomogSims/E4kPa_foc9p5mm_a0p3_TopBCconst/F1p0/cirs.dyn .");
					system("perl -pi -e 's/F1p0/$FN/g' cirs.dyn");
					system("perl -pi -e 's/9p5/$FD/g' cirs.dyn");
					switch ($A)
						{
						case "0p3" {$Anum = '0.3'}
						case "0p5" {$Anum = '0.5'}
						case "0p7" {$Anum = '0.7'}
						case "1p0" {$Anum = '1.0'}
						case "1p5" {$Anum = '1.5'}
						case "2p0" {$Anum = '2.0'}
						}
					system("perl -pi -e 's/output0.3.asc/output$Anum.asc/g' cirs.dyn");
					}
				system("ls-dyna-s i=cirs.dyn");
				system("dclean");
				system("matlab < /data/mlp6/DynaPostProc.m");			
				if(-e "zdisp.mat")
					{
					system("rm d3plot*");
					}
				}

			chdir($FullPath);

			}
		}
	}
